from typing import Union
from ftplib import FTP


DWD_FTP_SERVER = "opendata.dwd.de"
dwd_ftp_connection = None


def get_ftp_connection() -> FTP:
    """
    Get DWD Open Data FTP connection
    """
    dwd_ftp_connection = FTP(DWD_FTP_SERVER)
    dwd_ftp_connection.login()
    return dwd_ftp_connection


def get_condicode(code: str) -> Union[int, None]:
    """
    Map DWD codes to Meteostat condicodes

    https://opendata.dwd.de/climate_environment/CDC/observations_germany/climate/hourly/weather_phenomena/recent/Wetter_Beschreibung.txt
    """
    condicodes = {
        "0": 1,
        "1": 2,
        "2": 1,
        "3": 3,
        "11": 5,
        "12": 5,
        "13": 23,
        "17": 25,
        "21": 8,
        "22": 15,
        "23": 12,
        "24": 10,
        "25": 17,
        "26": 21,
        "27": 24,
        "28": 5,
        "29": 25,
        "40": 5,
        "41": 5,
        "42": 5,
        "43": 5,
        "44": 5,
        "45": 5,
        "46": 5,
        "47": 5,
        "48": 5,
        "49": 5,
        "50": 7,
        "51": 7,
        "52": 8,
        "53": 8,
        "54": 9,
        "55": 9,
        "56": 10,
        "57": 11,
        "58": 7,
        "59": 8,
        "60": 7,
        "61": 7,
        "62": 8,
        "63": 8,
        "64": 9,
        "65": 9,
        "66": 10,
        "67": 11,
        "68": 12,
        "69": 13,
        "70": 14,
        "71": 14,
        "72": 15,
        "73": 15,
        "74": 16,
        "75": 16,
        "80": 17,
        "81": 18,
        "82": 18,
        "83": 19,
        "84": 20,
        "85": 21,
        "86": 22,
        "87": 19,
        "88": 20,
        "89": 24,
        "90": 24,
        "91": 25,
        "92": 26,
        "93": 25,
        "94": 26,
        "95": 25,
        "96": 25,
        "97": 26,
        "98": 25,
        "99": 26,
        "100": 3,
        "101": 2,
        "102": 3,
        "103": 3,
        "120": 5,
        "123": 8,
        "124": 15,
        "125": 10,
        "126": 25,
        "130": 5,
        "131": 5,
        "132": 5,
        "133": 5,
        "134": 5,
        "135": 6,
        "150": 8,
        "151": 7,
        "152": 8,
        "153": 9,
        "154": 10,
        "155": 10,
        "156": 11,
        "157": 7,
        "158": 8,
        "160": 8,
        "161": 7,
        "162": 8,
        "163": 9,
        "164": 10,
        "165": 10,
        "166": 11,
        "167": 12,
        "168": 13,
        "170": 15,
        "171": 14,
        "172": 15,
        "173": 16,
        "177": 14,
        "181": 7,
        "182": 8,
        "183": 9,
        "184": 9,
        "185": 14,
        "186": 15,
        "187": 16,
        "189": 24,
        "190": 25,
        "191": 25,
        "192": 25,
        "193": 25,
        "194": 26,
        "195": 26,
        "196": 26,
        "199": 27,
    }

    return condicodes.get(str(code), None)
